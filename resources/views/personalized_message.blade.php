<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Meta -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta content="Anil z" name="author">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <!-- SITE TITLE -->
  <title>Kinchitkaram Trust</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
  <!-- Favicon Icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/styles/metro/notify-metro.min.css" />
  <script>
    pr = 11917 57;

    var sc_ i nvsi ble = 1;

    v a r ecuriy = " 8e;

    vrs tps = 1;
  </script>
  <script src="../../../www.statcounter.com/counter/counter.js" async></script>
  <style>
    .page-title {
      text-align: center;
      font-size: 60px;
      line-height: 1.35;
      color: #000 !important;
    }

    .breadcrumb-nav {
      margin-top: 20px;
      line-height: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .breadcrumb-nav li {
      margin: 0 6px;
      font-size: 20px;
      font-weight: 500;
      list-style-type: none;
    }

    section {
      padding: 50px 0;
      position: relative;
      width: 100%;
      z-index: 1;
    }

    .h4_clr {
      color: #0033FF;
      border-bottom: 1px dashed #ccc;
      margin: 5px 0;
    }

    .high-row-content .high-mid-row label {
      font-size: 13px;
      font-weight: 500;
      text-transform: capitalize;
      color: #555;
      float: left;
      width: 40%;
    }

    .high-row-content .high-mid-row span {
      font-size: 13px;
      color: #555;
      float: left;
      width: 60%;
      font-weight: 400;
    }

    .user-picture1 {
      overflow: hidden;
      object-fit: cover;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: auto;
      background: #ebebeb;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #bababa;
      box-shadow: 0 6px 10px rgba(207, 212, 222, 1);
    }

    .veiwprof_partright {
      box-shadow: 0 1px 2px rgba(43, 59, 93, 0.29);
      overflow: hidden;
      background-color: #fff;
      padding: 15px 15px;
      margin: 5px;
      border-radius: 10px;
    }

    .card-client1 {
      background: #ebebeb;
      padding-top: 25px;
      padding-bottom: 25px;
      padding-left: 20px;
      padding-right: 20px;
      border: 4px solid #d7d7d7;
      box-shadow: 0 6px 10px rgba(207, 212, 222, 1);
      border-radius: 10px;
      text-align: center;
      color: #fff;
      font-family: "Poppins", sans-serif;
      transition: all 0.3s ease;
    }

    .card-client1:hover {
      transform: translateY(-10px);
    }

    .user-picture1 {
      overflow: hidden;
      object-fit: cover;
      display: flex;
      justify-content: center;
      align-items: center;
      margin: auto;
      background: #ebebeb;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #bababa;
      box-shadow: 0 6px 10px rgba(207, 212, 222, 1);
    }

    .user-picture1 svg {
      width: 2.5rem;
      fill: currentColor;
    }

    .name-client1 {
      margin: 0;
      margin-top: 20px;
      font-weight: 600;
      font-size: 18px;
    }

    .name-client1 span {
      display: block;
      font-weight: 200;
      font-size: 16px;
    }

    .high-mid-row {
      float: left;
      width: 100%;
      margin-bottom: -2px;
    }

    .high-mid-row label {
      font-size: 15px;
      font-weight: 500;
      text-transform: uppercase;
      color: #000;
      float: left;
      width: 40%;
      text-align: justify;


    }

    .high-mid-row span {
      font-size: 15px;
      color: #000;
      float: left;
      width: 60%;
      font-weight: 400;
      text-align: justify;

    }

    .modal-dialog {
      top: 11%;
    }

    .modal {
      --bs-modal-width: 700px !important;
    }
  </style>
</head>

<body>
  <!-- header -->
  @include('include.header')
  <section class="bred-crum" style="background-image:url({{env('MAIN_URL')}}public/assets/images/breadcrum/header.jpg);">
    <div class="container">
      <h2 class="page-title">Send Personalised Message</h2>
      <ul class="breadcrumb-nav">
        <li><a href="#">Home</a></li>
        <li><i class="fas fa-angle-right"></i></li>
        <li>Send Personalised Message </li>
      </ul>
    </div>
  </section>
  <section class=" about-one--home section-space1">
    <div class="about-one__bg">
      <div class="about-one__bg__border"></div>
      <div class="about-one__bg__inner"></div>
    </div>
    <!-- /.about-one__left__bg -->
    <div class="container">
      <div class="row gutter-y-50 justify-content-center mb-5">
        <p class="text-center mb-4">Listed Below are <strong>Sent Personalised</strong> messages.</p>
        <div class="col-xl-8 col-md-12">
          <!-- Demo header-->
          <div class="card-client1 mb-3">
            <!-- <div class="row">
                        <div class="col-4">
    <h2 class="mymatc-id"><a href="#" class="def-anc"></a></h2>
</div>
<div class="col-4" style="align-self: center;">
    <a href="#" class="horo-a" contenteditable="false" style="cursor: pointer;"  data-toggle="modal" data-target="#exampleModal1" data-fromid="${fromID}"><i class="fa fa-user"></i> View Message</a>
</div><div class="col-4" style="align-self: center;">
    <a href="lakshimi_profile" class="horo-a" contenteditable="false" style="cursor: pointer;"> <i class="fa fa-trash"></i> Delete</a>
</div>
 </div>   -->

          </div>

          <!-- <div class="card-client1 mb-3">
                        <div class="row">
                        <div class="col-4">
    <h2 class="mymatc-id"><a href="#" class="def-anc">K28074</a></h2>
</div>
<div class="col-4" style="align-self: center;">
    <a href="#" class="horo-a" contenteditable="false" style="cursor: pointer;" data-toggle="modal" data-target="#exampleModal1"><i class="fa fa-user"></i> View Message</a>
</div><div class="col-4" style="align-self: center;">
    <a href="lakshimi_profile" class="horo-a" contenteditable="false" style="cursor: pointer;"> <i class="fa fa-trash"></i> Delete</a>
</div>
 </div>  
  
</div> -->
          <!-- /.about-one__content -->
        </div>
      </div>
      <!-- /.row -->
    </div>
    <!-- /.container -->
  </section>

  <div class="modal fade" id="exampleModal1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">

          <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="heading-block center nobottommargin">
            <h2 style="color: #990101;text-align: center;text-transform: uppercase;">Sent Message</h2>
          </div>
          <br>
          <table class="table table-bordered table-striped">
            <tbody>
              <tr>
                <td width="25%">From : </td>
                <td width="25%"><strong>K25102</strong></td>
                <td width="25%">To : </td>
                <td width="25%"><strong>K25869</strong></td>
              </tr>
            </tbody>
          </table>
          <table class="table table-bordered table-striped">
            <tbody>
              <tr>
                <td>Message : </td>
                <td style="word-break: break-all;">--------Original Message------&lt; Hi this is a testhi this is a test</td>
              </tr>
              <tr>
                <td>Sent on : </td>
                <td style="text-align: center;">12-06-2017
                  <form method="post" action="personalmsg_delete.php" style="display:inline;">
                    <button type="submit" class="sum" style="float:right;">Delete</button>
                    <input type="hidden" name="type" value="FromID"><input type="hidden" name="id" value="388">
                  </form>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <!-- START FOOTER -->
  @include('include.footer')
  <!-- hitwebcounter Code START -->
  <!-- END FOOTER -->
  <div class="wats">
    <div class="wats2">
      <a href="https://api.whatsapp.com/send/?phone=%2B918754483776&amp;text&amp;app_absent=0" target="_blank"><img src="{{env('MAIN_URL')}}/images/whatsapp.png"></a>
    </div>
  </div>
  <a href="#" class="scrollup" style="display: none;"><i class="ion-ios-arrow-up"></i></a>
  <script src="{{env('MAIN_URL')}}public/assets/js/jquery-1.12.4.min.js"></script>
  <!-- jquery-ui js -->
  <script src="{{env('MAIN_URL')}}public/assets/js/jquery-ui.js"></script>
  <!-- popper min js -->
  <script src="{{env('MAIN_URL')}}public/assets/js/popper.min.js"></script>
  <!-- Latest compiled and minified Bootstrap -->
  <script src="{{env('MAIN_URL')}}public/assets/bootstrap/js/bootstrap.min.js"></script>
  <!-- owl-carousel min js  -->
  <script src="{{env('MAIN_URL')}}public/assets/owlcarousel/js/owl.carousel.min.js"></script>
  <!-- magnific-popup min js  -->
  <script src="{{env('MAIN_URL')}}public/assets/js/magnific-popup.min.js"></script>
  <!-- waypoints min js  -->
  <script src="{{env('MAIN_URL')}}public/assets/js/waypoints.min.js"></script>
  <!-- parallax js  -->
  <script src="{{env('MAIN_URL')}}public/assets/js/parallax.js"></script>
  <!-- jquery dd js  -->
  <script src="{{env('MAIN_URL')}}public/assets/js/jquery.dd.min.js"></script>
  <!-- countdown js  -->
  <script src="{{env('MAIN_URL')}}public/assets/js/jquery.countdown.min.js"></script>
  <!-- jquery.counterup.min js -->
  <script src="{{env('MAIN_URL')}}public/assets/js/jquery.counterup.min.js"></script>
  <!-- jquery.parallax-scroll js -->
  <script src="{{env('MAIN_URL')}}public/assets/js/jquery.parallax-scroll.js"></script>
  <!-- fit video  -->
  <script src="{{env('MAIN_URL')}}public/assets/js/jquery.fitvids.js"></script>
  <!-- imagesloaded js -->
  <script src="{{env('MAIN_URL')}}public/assets/js/imagesloaded.pkgd.min.js"></script>
  <!-- isotope min js -->
  <script src="{{env('MAIN_URL')}}public/assets/js/isotope.min.js"></script>
  <!-- cookie js -->
  <script src="{{env('MAIN_URL')}}public/assets/js/js.cookie.js"></script>
  <script src="{{env('MAIN_URL')}}public/assets/js/scripts.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/notify/0.4.2/notify.min.js"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

  <script>
    $(function() {
      GetInbox();
    });

    // function GetInbox() {
    //   var formdata = new FormData();
    //   formdata.append('token', getCookie('token'));
    //   formdata.append('device_id', '1');

    //   $.ajax({
    //     type: 'post',
    //     url: "{{ env('API_URL') }}get-inbox",
    //     data: formdata,
    //     processData: false,
    //     contentType: false,
    //     success: function(response) {
    //       if (response.status == 200) {
    //         var messageData = response.data;
    //         console.log(messageData);

    //         var fromIDs = messageData.map(function(item) {
    //           return item.FromID;
    //         });
    //         console.log(fromIDs);

    //         var html = '';
    //         fromIDs.forEach(function(fromID) {
    //           html += `
    //     <div class="card-client1 mb-3">
    //         <div class="row">
    //             <div class="col-4">
    //                 <h2 class="mymatc-id"><a href="#" class="def-anc">${fromID}</a></h2>
    //             </div>
    //             <div class="col-4" style="align-self: center;">
    //               <a href="#" class="horo-a" contenteditable="false" style="cursor: pointer;" data-toggle="modal" data-target="#exampleModal1" onclick="ReceivedMessages('${fromID}'); return false;"><i class="fa fa-user"></i> View Message</a>
    //           </div>

    //             <div class="col-4" style="align-self: center;">
    //                 <a href="#" class="horo-a delete-message" contenteditable="false" style="cursor: pointer;"> <i class="fa fa-trash"></i>${response['data'].pid}Delete</a>
    //             </div>
    //         </div>
    //     </div>`;
    //         });

    //         $('.card-client1').html(html);

    //       } else if (response.status == 400) {
    //         // Handle 400 status
    //       } else if (response.status == 500) {
    //         // Handle 500 status
    //       } else if (response['status'] == 501) {
    //         $.confirm({
    //           title: 'Encountered an error!',
    //           content: response['error'],
    //           type: 'red',
    //           typeAnimated: true,
    //           icon: 'fa fa-warning',
    //           closeIcon: true,
    //           buttons: {
    //             tryAgain: {
    //               text: 'OK',
    //               btnClass: 'btn-red',
    //               action: function() {
    //                 sessionStorage.clear();
    //                 deleteCookie('typeofuser');
    //                 deleteCookie('token');
    //                 deleteCookie('marital_acc');
    //                 window.location.href = '/user-login';
    //               }
    //             }
    //           }
    //         });
    //       }
    //     },


    //     error: function(data) {
    //       console.log('Error:', data);
    //     }
    //   });
    // }

    function GetInbox() {
    var formdata = new FormData();
    formdata.append('token', getCookie('token'));
    formdata.append('device_id', '1');

    $.ajax({
        type: 'post',
        url: "{{ env('API_URL') }}get-inbox",
        data: formdata,
        processData: false,
        contentType: false,
        success: function(response) {
            if (response.status == 200) {
                var messageData = response.data;
                console.log(messageData);

                var html = '';
                messageData.forEach(function(message) {
                    var fromID = message.FromID;
                    var pid = message.pid;

                    html += `
                    <div class="card-client1 mb-3">
                        <div class="row">
                            <div class="col-4">
                                <h2 class="mymatc-id"><a href="#" class="def-anc">${fromID}</a></h2>
                            </div>
                            <div class="col-4" style="align-self: center;">
                                <a href="#" class="horo-a" contenteditable="false" style="cursor: pointer;" data-toggle="modal" data-target="#exampleModal1" onclick="ReceivedMessages('${fromID}'); return false;"><i class="fa fa-user"></i> View Message</a>
                            </div>
                            <div class="col-4" style="align-self: center;">
                            <a href="#" class="horo-a delete-message" data-pid="${pid}" contenteditable="false" style="cursor: pointer;"><i class="fa fa-trash"></i>Delete</a>
                            </div>
                        </div>
                    </div>`;
                });

                $('.card-client1').html(html);

            }else if (response.status == 400) {
                var messageData = response.message;
                var html = `<p style="text-align:center;">${messageData}</p>`;
                $('.card-client1').html(html);
            } else if (response.status == 500) {
                // Handle 500 status
            }  if (response['status'] == 501) {
                    $.confirm({
                        title: 'error!',
                        content: 'Kindly login to proceed',
                        type: 'red',
                        typeAnimated: true,
                        icon: 'fa fa-warning',
                        closeIcon: false,
                        buttons: {
                            tryAgain: {
                                text: 'OK',
                                btnClass: 'btn-red',
                                action: function() {
                                    sessionStorage.clear();
                                    deleteCookie('typeofuser');
                                    deleteCookie('token');
                                    deleteCookie('marital_acc');
                                    window.location.href = '/user-login';
                                }
                            },
                            // close: function() {
                            //     sessionStorage.clear();
                            //     deleteCookie('typeofuser');
                            //     deleteCookie('token');
                            //     deleteCookie('marital_acc');
                            //     window.location.href = '/user-login';
                            // }
                        }
                    });

                }
        },
        error: function(data) {
            console.log('Error:', data);
        }
    });
}



    $(document).ready(function() {
      $('.horo-a').click(function(event) {
        event.preventDefault();
        event.stopPropagation();
        console.log('Clicked');
        var fromID = $(this).data('fromid');
        console.log('From ID:', fromID);
        ReceivedMessages(fromID);
        $('#exampleModal1').modal('show');
      });
    });





    function ReceivedMessages(fromid) {
      var formdata = new FormData();
      formdata.append('token', getCookie('token'));
      formdata.append('device_id', '1');
      formdata.append('fromid', fromid);

      $.ajax({
        type: 'post',
        url: "{{ env('API_URL') }}get-received-messages",
        data: formdata,
        processData: false,
        contentType: false,
        success: function(response) {
          if (response.status == 200 && Array.isArray(response.data)) {
            // Generate HTML for all messages
            var messagesHTML = response.data.map(function(message) {
              return `
                      <tr>
                          <td width="25%">From : </td><td width="25%"><strong>${message.FromID}</strong></td>
                          <td width="25%">To : </td><td width="25%"><strong>${message.ToID}</strong></td>
                      </tr>
                      <tr>
                          <td colspan="1">Message : </td><td colspan="4" rowspan="1" style="text-align: center;">${message.Msg}</td>
                      </tr>
                      <tr>
                          <td colspan="1">Sent on : </td><td colspan="4" rowspan="1"  style="text-align: center;">${message.SendDate}</td>
                      </tr>
                  `;
            }).join('');


            var modalBodyContent = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="heading-block center nobottommargin">
                                <h2 style="color: #990101;text-align: center;text-transform: uppercase;">Sent Message</h2>
                            </div>
                            <br>
                            <table class="table table-bordered table-striped">
                                <tbody>
                                    ${messagesHTML}
                                </tbody>
                            </table>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                `;

            $('.modal-content').html(modalBodyContent);
            $('#exampleModal1').modal('show');
          } else {
            console.log('Invalid response data format.');
          }
        },
        error: function(data) {
          console.log('Error:', data);
        }
      });
    }

    $(document).on('click', '.delete-message', function(event) {
    event.preventDefault();
    var pid = $(this).data('pid');
    $.confirm({
        title: 'Confirmation',
        content: 'Are you sure you want to delete this message?',
        type: 'green',
        typeAnimated: true,
        buttons: {
            confirm: {
                text: 'Yes',
                btnClass: 'btn-green',
                action: function () {
                    var formdata = new FormData();
                    formdata.append('token', getCookie('token'));
                    formdata.append('device_id', '1');
                    formdata.append('pid', pid);

                    $.ajax({
                        type: 'POST',
                        url: "{{ env('API_URL') }}delete-message",
                        data: formdata,
                        processData: false,
                        contentType: false,
                        success: function(response) {
                            if (response.status === 200) {
                                $.confirm({
                                    title: 'Success!',
                                    content: response['message'],
                                    type: 'success',
                                    typeAnimated: true,
                                    closeIcon: true,
                                    buttons: {
                                        ok: { 
                                            text: 'OK', 
                                            btnClass: 'btn-success', 
                                            action: function() {
                                                location.reload();
                                            }
                                        },
                                    }
                                });
                            } else {
                                $.confirm({
                                    title: 'Error!',
                                    content: 'Failed to delete message.',
                                    type: 'red',
                                    typeAnimated: true,
                                    buttons: {
                                        ok: {
                                            text: 'OK',
                                            btnClass: 'btn-red',
                                            action: function () {}
                                        }
                                    }
                                });
                            }
                        },
                        error: function(xhr, status, error) {
                            alert('An error occurred while deleting the message.');
                        }
                    });
                }
            },
            cancel: {
                text: 'No',
                btnClass: 'btn-red',
                action: function () {}
            }
        }
    });
});

  </script>
</body>

</html>